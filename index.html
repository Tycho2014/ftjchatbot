<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TJ Chatbot 2.1</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: #e5ddd5;
}
.messages {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}
.message {
    max-width: 70%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    animation: fadeIn 0.3s ease-in-out;
}
.user {
    align-self: flex-end;
    background: #dcf8c6;
}
.bot {
    align-self: flex-start;
    background: #fff;
}
@keyframes fadeIn {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
}
.top-buttons {
    text-align: center;
    padding: 10px;
    background: #fff;
    border-bottom: 1px solid #ccc;
}
.top-buttons button {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
.search-area {
    padding: 10px;
    background: #fff;
    border-bottom: 1px solid #ccc;
}
.search-area input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 20px;
    outline: none;
}
.search-results {
    max-height: 150px;
    overflow-y: auto;
    background: #f9f9f9;
    padding: 10px;
    border-bottom: 1px solid #ccc;
    font-size: 14px;
}
.search-results div {
    padding: 4px 0;
    border-bottom: 1px solid #ddd;
    cursor: pointer;
}
.input-area {
    display: flex;
    padding: 10px;
    background: #fff;
    border-top: 1px solid #ccc;
    width: 100%;
    box-sizing: border-box;
}
.input-area input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 25px;
    outline: none;
    font-size: 16px;
}
.input-area button {
    margin-left: 10px;
    padding: 12px 18px;
    border: none;
    border-radius: 50%;
    background: #007bff;
    color: white;
    cursor: pointer;
    font-size: 18px;
}
</style>
</head>
<body>
<div class="top-buttons">
    <a href="bulk.html"><button>Leer de TJ - Chatbot</button></a>
</div>

<div class="search-area">
    <input type="text" id="searchInput" placeholder="Zoek in AI-geheugen..." oninput="searchMemory()">
</div>
<div class="search-results" id="searchResults"></div>
<div class="messages" id="messages"></div>
<div class="input-area">
    <input type="text" id="userInput" placeholder="Typ je bericht...">
    <button onclick="sendMessage()">➤</button>
</div>

<!-- Audio-elementen voor liedjes -->
<audio id="songPlayer" src="Verlangen.mp3"></audio>
<audio id="koePlayer" src="boe.mp3"></audio>

<script>
const PANTRY_ID = "27f304e8-7ec3-4665-af07-de462c0c8add";
const PANTRY_URL = `https://getpantry.cloud/apiv1/pantry/${PANTRY_ID}/basket/qna`;

// VOORLEZEN
function speak(text) {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'nl-NL';
        window.speechSynthesis.speak(utterance);
    }
}

async function leerVraagAntwoord(vraag, antwoord) {
    let qna = await fetch(PANTRY_URL).then(r => r.json()).catch(() => ({}));
    qna[vraag] = antwoord;
    await fetch(PANTRY_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(qna)
    });
}

async function haalAntwoordOp(vraag) {
    let qna = await fetch(PANTRY_URL).then(r => r.json()).catch(() => ({}));
    return qna[vraag] || "Niet geleerd!";
}

let memory = JSON.parse(localStorage.getItem('chatbotMemory')) || {};
let waitingForAnswer = null;

// Voeg standaardregels toe
const standaardregels = {
    "hey": "Hallo! Ik ben een AI en ik ben hier om je te helpen.",
    "hoi": "Hoi! Leuk dat je er bent.",
    "hallo": "Hallo! Zin in een goed gesprek?",
    "wat is jouw naam": "Ik ben TJ Chatbot 2.1.",
    "wie ben jij": "Ik ben een digitale assistent die graag helpt.",
    "wat kun jij": "Ik kan praten, onthouden, leren en helpen.",
    "wat is AI": "AI staat voor kunstmatige intelligentie.",
    "goedemorgen": "Goedemorgen! Hopelijk heb je goed geslapen.",
    "goedemiddag": "Goedemiddag! Wat staat er op je planning?",
    "goedenavond": "Goedenavond! Tijd voor een praatje?",
    "hoe gaat het": "Met mij gaat het goed, dank je!",
    "yo": "Yo! Klaar om te chatten?",
    "wat is water": "Water is H2O, essentieel voor leven.",
    "wat is lucht": "Lucht is een mengsel van gassen, vooral stikstof en zuurstof.",
    "wat is liefde": "Liefde is een diepe emotionele verbondenheid tussen mensen.",
    "wat is tijd": "Tijd is een dimensie waarin gebeurtenissen plaatsvinden.",
    "wat is muziek": "Muziek is kunst met geluid, ritme en emotie.",
    "wat is een computer": "Een computer is een apparaat dat informatie verwerkt.",
    "wat is een robot": "Een robot is een machine die taken automatisch uitvoert.",
    "wat is een mens": "Een mens is een denkend en voelend wezen.",
    "wat is een AI": "AI is een systeem dat leert en beslissingen neemt.",
    "wat is een boom": "Een boom is een plant met een stam, takken en bladeren.",
    "wat is een hond": "Een hond is een trouwe viervoeter en huisdier.",
    "wat is een kat": "Een kat is een eigenzinnig en nieuwsgierig dier.",
    "wat is een vis": "Een vis leeft in water en ademt met kieuwen.",
    "wat is een vogel": "Een vogel is een dier met veren dat meestal kan vliegen.",
    "wat is een planeet": "Een planeet is een hemellichaam dat rond een ster draait.",
    "wat is de zon": "De zon is een ster die licht en warmte geeft.",
    "wat is de maan": "De maan is de natuurlijke satelliet van de aarde.",
    "wat is een ster": "Een ster is een gloeiend gasbol in de ruimte.",
    "wat is het heelal": "Het heelal is alles wat bestaat: ruimte, tijd en materie.",
    "wat is energie": "Energie is de kracht om dingen te laten bewegen of veranderen.",
    "wat is elektriciteit": "Elektriciteit is een stroom van geladen deeltjes.",
    "wat is een regenboog": "Een regenboog ontstaat als licht breekt door waterdruppels.",
    "wat is sneeuw": "Sneeuw is bevroren water in de vorm van kristallen.",
    "wat is ijs": "IJs is water in vaste vorm, koud en glad.",
    "wat is een storm": "Een storm is een krachtige weersituatie met veel wind.",
    "wat is een vulkaan": "Een vulkaan is een berg die lava en gas uitspuwt.",
    "wat is lava": "Lava is gesmolten gesteente uit het binnenste van de aarde.",
    "wat is een berg": "Een berg is een hoge natuurlijke verhoging van het aardoppervlak.",
    "wat is een rivier": "Een rivier is stromend water dat naar zee gaat.",
    "wat is een oceaan": "Een oceaan is een enorme watermassa die continenten scheidt.",
    "wat is een meer": "Een meer is een grote hoeveelheid stilstaand water.",
    "wat is een woestijn": "Een woestijn is een droog gebied met weinig neerslag.",
    "wat is een bos": "Een bos is een gebied vol bomen en planten.",
    "wat is een eiland": "Een eiland is een stuk land omringd door water.",
    "wat is een continent": "Een continent is een grote landmassa zoals Europa of Afrika.",
    "wat is Nederland": "Nederland is een land in Europa, bekend om water, kaas en fietsen.",
    "wat is taal": "Taal is een systeem van communicatie met woorden en tekens.",
    "wat is humor": "Humor is iets dat mensen aan het lachen maakt.",
    "wat is verdriet": "Verdriet is een emotie van pijn of verlies.",
    "wat is geluk": "Geluk is een gevoel van tevredenheid en vreugde.",
    "wat is angst": "Angst is een emotie die waarschuwt voor gevaar.",
    "wat is hoop": "Hoop is het verlangen naar een positieve uitkomst.",
    "wat is dromen": "Dromen zijn beelden en verhalen die je ziet tijdens het slapen.",
    "wat is slaap": "Slaap is rust voor lichaam en geest om te herstellen.",
    "wat is eten": "Eten is brandstof voor je lichaam en vaak ook genieten.",
    "wat is drinken": "Drinken is essentieel om gehydrateerd te blijven.",
    "wat is sport": "Sport is beweging, competitie en plezier.",
    "wat is voetbal": "Voetbal is een teamsport met een bal en doelpunten.",
    "wat is muziek maken": "Muziek maken is creatief zijn met geluid.",
    "wat is kunst": "Kunst is expressie van gevoelens en ideeën.",
    "wat is technologie": "Technologie is het gebruik van kennis voor praktische toepassingen.",
    "wat is wetenschap": "Wetenschap onderzoekt en verklaart hoe de wereld werkt.",
    "wat is geschiedenis": "Geschiedenis is het verhaal van het verleden.",
    "wat is toekomst": "Toekomst is wat nog moet komen.",
    "wat is gisteren": "Gisteren was de dag vóór vandaag.",
    "wat is vandaag": "Vandaag is het huidige moment.",
    "wat is morgen": "Morgen is de dag na vandaag.",
    "wat is een seconde": "Een seconde is een eenheid van tijd, heel kort.",
    "wat is een minuut": "Een minuut bestaat uit 60 seconden.",
    "wat is een uur": "Een uur bestaat uit 60 minuten.",
    "wat is een dag": "Een dag duurt 24 uur.",
    "wat is een week": "Een week heeft 7 dagen.",
    "wat is een maand": "Een maand is ongeveer 30 dagen.",
    "wat is een jaar": "Een jaar heeft 365 dagen, behalve in een schrikkeljaar.",
    "wat is een schrikkeljaar": "Een schrikkeljaar heeft 366 dagen.",
    "wat is een kalender": "Een kalender toont dagen, weken en maanden.",
    "wat is een klok": "Een klok toont de tijd.",
    "wat is een spiegel": "Een spiegel reflecteert je beeld.",
    "wat is een boek": "Een boek is een verzameling geschreven of gedrukte pagina’s.",
    "wat is een verhaal": "Een verhaal is een reeks gebeurtenissen, echt of verzonnen.",
    "wat is fantasie": "Fantasie is het vermogen om dingen te bedenken die niet echt zijn.",
    "wat is realiteit": "Realiteit is de wereld zoals die werkelijk is.",
    "wat is een droom": "Een droom is een ervaring tijdens het slapen.",
    "wat is een nachtmerrie": "Een nachtmerrie is een enge droom.",
    "wat is een feest": "Een feest is een vrolijke bijeenkomst met mensen.",
    "wat is een verjaardag": "Een verjaardag is de viering van je geboortedag.",
    "wat is een cadeau": "Een cadeau is iets dat je aan iemand geeft.",
    "wat is vriendschap": "Vriendschap is een band tussen mensen gebaseerd op vertrouwen.",
    "wat is familie": "Familie zijn mensen die met je verwant zijn.",
    "wat is school": "School is een plek waar je leert.",
    "wat is werk": "Werk is een activiteit waarvoor je meestal betaald wordt.",
    "wat is vakantie": "Vakantie is vrije tijd om te ontspannen.",
    "wat is internet": "Internet is een wereldwijd netwerk voor informatie en communicatie.",
    "wat is een website": "Een website is een plek op internet met informatie.",
    "wat is een app": "Een app is een programma op je telefoon of tablet.",
    "wat is een smartphone": "Een smartphone is een slimme mobiele telefoon.",
    "wat is een tablet": "Een tablet is een draagbaar scherm met apps.",
    "wat is een laptop": "Een laptop is een draagbare computer.",
    "wat is een game": "Een game is een interactief spel, vaak digitaal.",
    "wat is programmeren": "Programmeren is instructies schrijven voor computers.",
    "wat is coderen": "Coderen is het maken van software met programmeertaal.",
    "wat is een algoritme": "Een algoritme is een reeks stappen om een probleem op te lossen.",
    "wat is data": "Data zijn feiten en cijfers die informatie geven.",
    "wat is privacy": "Privacy is het recht om persoonlijke informatie te beschermen.",
    "wat is een wachtwoord": "Een wachtwoord is een geheime code om toegang te krijgen.",
    "wat is een virus": "Een virus is een schadelijk programma of een ziekteverwekker.",
    "wat is gezondheid": "Gezondheid is een toestand van lichamelijk en geestelijk welzijn.",
    "wat is een dokter": "Een dokter helpt mensen gezond te blijven of te worden.",
    "wat is een ziekenhuis": "Een ziekenhuis is een plek waar mensen medische zorg krijgen.",
    "wat is een medicijn": "Een medicijn helpt om ziektes te genezen of te verlichten."
}

};
Object.keys(standaardregels).forEach(vraag => {
    if (!memory[vraag]) {
        memory[vraag] = standaardregels[vraag];
    }
});
localStorage.setItem('chatbotMemory', JSON.stringify(memory));

function sendMessage() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, 'user');
    input.value = '';

    if (waitingForAnswer) {
        memory[waitingForAnswer] = text;
        localStorage.setItem('chatbotMemory', JSON.stringify(memory));
        leerVraagAntwoord(waitingForAnswer, text);
        typeMessage("Bedankt! Zo kunnen we de TJ AI verder trainen.");
        speak("Bedankt! Zo kunnen we de TJ AI verder trainen.");
        waitingForAnswer = null;
        return;
    }
    setTimeout(() => botReply(text), 500);
}

function addMessage(text, sender) {
    const msgContainer = document.createElement('div');
    msgContainer.classList.add('message', sender);
    msgContainer.textContent = text;
    document.getElementById('messages').appendChild(msgContainer);
    document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

function botReply(userText) {
    let reply = null;
    const lower = userText.toLowerCase();

    // Audio triggers
    if (lower === "zing een gek lied") {
        reply = "Hier .....!";
        typeMessage(reply);
        speak(reply);
        const audio = document.getElementById('songPlayer');
        audio.currentTime = 0;
        audio.play();
        return;
    }
    if (lower === "zing een koe lied") {
        reply = "De koe zingt: boe!";
        typeMessage(reply);
        speak(reply);
        const koeAudio = document.getElementById('koePlayer');
        koeAudio.currentTime = 0;
        koeAudio.play();
        return;
    }

    if (memory[lower]) {
        reply = memory[lower];
        typeMessage(reply);
        speak(reply);
    } else if (
        lower.includes("hallo") ||
        lower.includes("hoe gaat het") ||
        lower.includes("wat is je naam")
    ) {
        if (lower.includes("hallo")) reply = "Hallo! Hoe kan ik je helpen?";
        if (lower.includes("hoe gaat het")) reply = "Met mij gaat het goed, dank je!";
        if (lower.includes("wat is je naam")) reply = "Ik ben TJ Chatbot 2.1.";
        typeMessage(reply);
        speak(reply);
    } else {
        haalAntwoordOp(lower).then(pantryAntwoord => {
            if (pantryAntwoord !== "Niet geleerd!") {
                typeMessage(pantryAntwoord);
                speak(pantryAntwoord);
                memory[lower] = pantryAntwoord;
                localStorage.setItem('chatbotMemory', JSON.stringify(memory));
            } else {
                typeMessage("Dat weet ik nog niet. Wat moet de AI zeggen?");
                speak("Dat weet ik nog niet. Wat moet de AI zeggen?");
                waitingForAnswer = lower;
            }
        });
    }
}

function typeMessage(text) {
    const msgContainer = document.createElement('div');
    msgContainer.classList.add('message', 'bot');
    document.getElementById('messages').appendChild(msgContainer);

    let i = 0;
    function typing() {
        if (i < text.length) {
            msgContainer.textContent += text.charAt(i);
            i++;
            setTimeout(typing, 40);
        }
    }
    typing();
}

function searchMemory() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    const resultsDiv = document.getElementById('searchResults');
    resultsDiv.innerHTML = '';

    if (term.length === 0) return;

    const results = Object.keys(memory).filter(q => q.includes(term));
    if (results.length === 0) {
        resultsDiv.innerHTML = '<div>Geen resultaten gevonden.</div>';
    } else {
        results.forEach(q => {
            const item = document.createElement('div');
            item.textContent = `${q} → ${memory[q]}`;
            item.onclick = () => {
                document.getElementById('userInput').value = q;
                document.getElementById('userInput').focus();
            };
            resultsDiv.appendChild(item);
        });
    }
}

document.getElementById('userInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
    }
});
</script>
</body>
</html>
